
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Getting Started - Lamassu IoT Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/scheme.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="lamassu" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Lamassu IoT Docs" class="md-header__button md-logo" aria-label="Lamassu IoT Docs" data-md-component="logo">
      
  <img src="../img/lamassu.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lamassu IoT Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="lamassu" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lamassuiot/lamassu-compose" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lamassuiot/lamassu-compose
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Lamassu IoT Docs" class="md-nav__button md-logo" aria-label="Lamassu IoT Docs" data-md-component="logo">
      
  <img src="../img/lamassu.svg" alt="logo">

    </a>
    Lamassu IoT Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lamassuiot/lamassu-compose" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lamassuiot/lamassu-compose
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome to Lamassu Iot Docs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Getting Started
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-new-certification-authority" class="md-nav__link">
    Create a new Certification Authority
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-a-new-device-manufacturing-system" class="md-nav__link">
    Register a new Device Manufacturing System
  </a>
  
    <nav class="md-nav" aria-label="Register a new Device Manufacturing System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-dms" class="md-nav__link">
    Manual DMS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-hosted-dms" class="md-nav__link">
    Cloud Hosted DMS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provision-your-devices-with-x509-certificates" class="md-nav__link">
    Provision your devices with x509 Certificates
  </a>
  
    <nav class="md-nav" aria-label="Provision your devices with x509 Certificates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-dms_1" class="md-nav__link">
    Manual DMS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-hosted-dms_1" class="md-nav__link">
    Cloud Hosted DMS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-ui" class="md-nav__link">
    Using the UI
  </a>
  
    <nav class="md-nav" aria-label="Using the UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-certification-authority_1" class="md-nav__link">
    Create a new Certification Authority
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registration-of-a-dms-using-the-ui" class="md-nav__link">
    Registration of a DMS using the UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registration-of-a-device-using-the-ui" class="md-nav__link">
    Registration of a device using the UI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-apis" class="md-nav__link">
    Using the APIs
  </a>
  
    <nav class="md-nav" aria-label="Using the APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#through-the-api-gateway" class="md-nav__link">
    Through the API Gateway
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-unit-tests" class="md-nav__link">
    Running Unit tests
  </a>
  
    <nav class="md-nav" aria-label="Running Unit tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtering-sorting-and-pagination" class="md-nav__link">
    Filtering, Sorting and Pagination
  </a>
  
    <nav class="md-nav" aria-label="Filtering, Sorting and Pagination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operators" class="md-nav__link">
    Operators
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../protocols/" class="md-nav__link">
        Protocols
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../manage/" class="md-nav__link">
        Managing Lamassu
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tests/" class="md-nav__link">
        Tests
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../virtual-dms/" class="md-nav__link">
        Lamassu Simulation Tools
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../virtual-device/" class="md-nav__link">
        Lamassu Virtual Device
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-new-certification-authority" class="md-nav__link">
    Create a new Certification Authority
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-a-new-device-manufacturing-system" class="md-nav__link">
    Register a new Device Manufacturing System
  </a>
  
    <nav class="md-nav" aria-label="Register a new Device Manufacturing System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-dms" class="md-nav__link">
    Manual DMS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-hosted-dms" class="md-nav__link">
    Cloud Hosted DMS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provision-your-devices-with-x509-certificates" class="md-nav__link">
    Provision your devices with x509 Certificates
  </a>
  
    <nav class="md-nav" aria-label="Provision your devices with x509 Certificates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-dms_1" class="md-nav__link">
    Manual DMS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-hosted-dms_1" class="md-nav__link">
    Cloud Hosted DMS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-ui" class="md-nav__link">
    Using the UI
  </a>
  
    <nav class="md-nav" aria-label="Using the UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-certification-authority_1" class="md-nav__link">
    Create a new Certification Authority
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registration-of-a-dms-using-the-ui" class="md-nav__link">
    Registration of a DMS using the UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registration-of-a-device-using-the-ui" class="md-nav__link">
    Registration of a device using the UI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-apis" class="md-nav__link">
    Using the APIs
  </a>
  
    <nav class="md-nav" aria-label="Using the APIs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#through-the-api-gateway" class="md-nav__link">
    Through the API Gateway
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-unit-tests" class="md-nav__link">
    Running Unit tests
  </a>
  
    <nav class="md-nav" aria-label="Running Unit tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtering-sorting-and-pagination" class="md-nav__link">
    Filtering, Sorting and Pagination
  </a>
  
    <nav class="md-nav" aria-label="Filtering, Sorting and Pagination">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operators" class="md-nav__link">
    Operators
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/lamassuiot/lamassu-compose/edit/master/docs/usage.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="getting-started">Getting Started</h1>
<p>Before jumping any further, please check out the <a href="/setup">installation process</a> to deploy all Lamassu services. This section will guide you through the basic functionalities provided by our PKI to start provisioning your devices.</p>
<h2 id="overview">Overview</h2>
<h3 id="create-a-new-certification-authority">Create a new Certification Authority</h3>
<p>The first step to provision your devices with digital certificates is to create the Certification Authority. The role of a CA is to issue and manage all the certificates. To create a new CA, fill the following form taking into account the following things:</p>
<ul>
<li>Lamassu supports both <code>RSA</code> and <code>EC</code> based CAs.</li>
<li>The CA name MUST be unique.</li>
<li>The CA expiration time must be greater than the lifespan of the issued certs.</li>
</ul>
<p><img alt="" src="../img/ca-registration.png" />
<img alt="" src="../img/ca-info.png" /> </p>
<h3 id="register-a-new-device-manufacturing-system">Register a new Device Manufacturing System</h3>
<p>Lamassu is a PKI designed for the industrial and IoT sector. To better integrate this PKI in real life manufacturing system, Lamassu delegates the issuance of device certificate to the factory itself. First lets dive into the Device Manufacturing System <em>(DMS for short)</em> registration step by step. After that, a couple of examples will demonstrate how to start enrolling your devices using the <a href="https://github.com/lamassuiot/lamassu-virtual-dms">Lamassu's Virtual DMS software</a> as well as using the UI.</p>
<p>Device manufacturing process tend to be highly automated. Provisioning the devices with digital identities should not slow down the fabrication process. Lamassu addresses this challenge introducing the DMS concept as core.</p>
<p>One of the factories operators stars the process by generating a DMS registration request contained in a Certificate Signing Request also referred as CSR. This CSR is then sent to the DMS Enroller service to be approved by one of the PKI Administrators:</p>
<figure>
<p><img alt="" src="../img/dms-step1.png" /></p>
</figure>
<p>The Administrator then decides if the request is approved or denied. If it decision is to approve the DMS registration request, the Administrator must specify which CAs will that particular DSM be entitled to issue certificates with:</p>
<figure>
<p><img alt="" src="../img/dms-step2.png" /></p>
</figure>
<p>Once, and only if, the DMS registration request is approved, then the Operator must retrieve the signed CSR and pass it to the DMS software that will be in charge off requesting the issuance of new digital certificates for the manufactured devices:</p>
<figure>
<p><img alt="" src="../img/dms-step3.png" /></p>
</figure>
<p>Finally, the DMS is able to request new x509 certificates for its manufactured devices. The DMS may be assisted by additional tools to obtain the manufactured device unique identifier. </p>
<figure>
<p><img alt="" src="../img/dms-step4.png" /></p>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Envoy is used as an API gateway in this project. Currently Envoy is written to use Boring SSl as the TLS provider. It does not support secp224r1 signing method, which is used to create ECDSA224 keys.
Therefore, enroll and reenroll methods will return a error when using this key. </p>
</div>
<p>Let's register a new DMS instance:</p>
<h4 id="manual-dms">Manual DMS</h4>
<ol>
<li>
<p><strong>Operator</strong> - Authenticate the user:
  <div class="highlight"><pre><span></span><code>OPERATOR_USERNAME=operator
OPERATOR_PASSWORD=operator
DOMAIN=dev.lamassu.io
</code></pre></div>
  <div class="highlight"><pre><span></span><code>OPERATOR_TOKEN=$(curl -k -s --location --request POST &quot;https://auth.$DOMAIN/auth/realms/lamassu/protocol/openid-connect/token&quot; --header &#39;Content-Type: application/x-www-form-urlencoded&#39; --data-urlencode &#39;grant_type=password&#39; --data-urlencode &#39;client_id=frontend&#39; --data-urlencode &quot;username=$OPERATOR_USERNAME&quot; --data-urlencode &quot;password=$OPERATOR_PASSWORD&quot; | jq -r .access_token)
</code></pre></div></p>
</li>
<li>
<p><strong>Operator</strong> - Request the registration for a new DMS instance:
  <div class="highlight"><pre><span></span><code>DMS_NAME=MyDMS
DMS_SUBJECT_COUNTRY=ES
DMS_SUBJECT_STATE=Gipuzkoa
DMS_SUBJECT_LOCALITY=Donostia
DMS_SUBJECT_ORGANIZATION=Lamassu
DMS_SUBJECT_ORGANIZATION_UNIT=IoT
</code></pre></div>
  <div class="highlight"><pre><span></span><code>DMS_REG_RESPONSE=$(curl -k --location --request POST &quot;https://$DOMAIN/api/dmsmanager/v1/&quot; \
--header &quot;Authorization: Bearer $OPERATOR_TOKEN&quot; \
--data-raw &quot;{\&quot;key_metadata\&quot;: {\&quot;bits\&quot;:3072, \&quot;type\&quot;:\&quot;RSA\&quot;}, \&quot;subject\&quot;:{\&quot;common_name\&quot;:\&quot;$DMS_NAME\&quot;, \&quot;country\&quot;:\&quot;$DMS_SUBJECT_COUNTRY\&quot;,\&quot;locality\&quot;:\&quot;$DMS_SUBJECT_LOCALITY\&quot;,\&quot;organization\&quot;:\&quot;$DMS_SUBJECT_ORGANIZATION\&quot;,\&quot;organization_unit\&quot;:\&quot;$DMS_SUBJECT_ORGANIZATION_UNIT\&quot;,\&quot;state\&quot;:\&quot;$DMS_SUBJECT_STATE\&quot;}}&quot;)
DMS_NAME=$(echo $DMS_REG_RESPONSE | jq -r .dms.name)
echo $DMS_REG_RESPONSE | jq -r .private_key | base64 -d &gt; dms.key
</code></pre></div></p>
</li>
<li>
<p><strong>Admin</strong> - Authenticate the admin user
  <div class="highlight"><pre><span></span><code>ENROLLER_USERNAME=enroller
ENROLLER_PASSWORD=enroller
DOMAIN=dev.lamassu.io
</code></pre></div>
  <div class="highlight"><pre><span></span><code>ENROLLER_TOKEN=$(curl -k -s --location --request POST &quot;https://auth.$DOMAIN/auth/realms/lamassu/protocol/openid-connect/token&quot; --header &#39;Content-Type: application/x-www-form-urlencoded&#39; --data-urlencode &#39;grant_type=password&#39; --data-urlencode &#39;client_id=frontend&#39; --data-urlencode &quot;username=$ENROLLER_USERNAME&quot; --data-urlencode &quot;password=$ENROLLER_PASSWORD&quot; | jq -r .access_token)
</code></pre></div></p>
</li>
<li>
<p><strong>Admin</strong> - Authorize the enrollment with all the provisioned CAs
  <div class="highlight"><pre><span></span><code>AUTHORIZED_CAS=$(curl -k &quot;https://$DOMAIN/api/ca/v1/pki&quot; --header &quot;Authorization: Bearer $ENROLLER_TOKEN&quot; | jq .cas[].name | jq -s)
</code></pre></div>
  <div class="highlight"><pre><span></span><code>curl -k --location --request PUT &quot;https://$DOMAIN/api/dmsmanager/v1/$DMS_NAME/status&quot; \
--header &quot;Authorization: Bearer $ENROLLER_TOKEN&quot; \
--data-raw &quot;{\&quot;status\&quot;:\&quot;APPROVED\&quot;}&quot;
</code></pre></div>
  <div class="highlight"><pre><span></span><code>curl -k --location --request PUT &quot;https://$DOMAIN/api/dmsmanager/v1/$DMS_NAME/auth&quot; \
--header &quot;Authorization: Bearer $ENROLLER_TOKEN&quot; \
--data-raw &quot;{\&quot;authorized_cas\&quot;:$AUTHORIZED_CAS}&quot;
</code></pre></div></p>
</li>
<li>
<p><strong>Operator</strong> - Get the DMS certificate:
  <div class="highlight"><pre><span></span><code>curl -k &quot;https://$DOMAIN/api/dmsmanager/v1/$DMS_NAME&quot; --header &quot;Authorization: Bearer $OPERATOR_TOKEN&quot; | jq -r .certificate | base64 -d &gt; dms.crt 
</code></pre></div></p>
</li>
</ol>
<h4 id="cloud-hosted-dms">Cloud Hosted DMS</h4>
<p>When creating a Cloud Hosted DMS the Payload of the request has three more parameters:</p>
<ul>
<li><strong>BootstrapCAs</strong>: Bootstrap CAs, i.e. the Bootstrap certificate used by the device has to be issued by one of these CAs, in case it is not issued by any of these CAs the device request will not be authorized.</li>
<li><strong>IsCloudDMS</strong>: It is a boolean parameter. In this case it always has the same value <strong>true</strong>.</li>
</ul>
<p>Let's register a new Cloud Hosted DMS instance:</p>
<ol>
<li>
<p><strong>Operator</strong> - Authenticate the user:
  <div class="highlight"><pre><span></span><code>OPERATOR_USERNAME=operator
OPERATOR_PASSWORD=operator
DOMAIN=dev.lamassu.io
</code></pre></div>
  <div class="highlight"><pre><span></span><code>OPERATOR_TOKEN=$(curl -k -s --location --request POST &quot;https://auth.$DOMAIN/auth/realms/lamassu/protocol/openid-connect/token&quot; --header &#39;Content-Type: application/x-www-form-urlencoded&#39; --data-urlencode &#39;grant_type=password&#39; --data-urlencode &#39;client_id=frontend&#39; --data-urlencode &quot;username=$OPERATOR_USERNAME&quot; --data-urlencode &quot;password=$OPERATOR_PASSWORD&quot; | jq -r .access_token)
</code></pre></div></p>
</li>
<li>
<p><strong>Admin</strong> - Authenticate the admin user
  <div class="highlight"><pre><span></span><code>ENROLLER_USERNAME=enroller
ENROLLER_PASSWORD=enroller
DOMAIN=dev.lamassu.io
</code></pre></div>
  <div class="highlight"><pre><span></span><code>ENROLLER_TOKEN=$(curl -k -s --location --request POST &quot;https://auth.$DOMAIN/auth/realms/lamassu/protocol/openid-connect/token&quot; --header &#39;Content-Type: application/x-www-form-urlencoded&#39; --data-urlencode &#39;grant_type=password&#39; --data-urlencode &#39;client_id=frontend&#39; --data-urlencode &quot;username=$ENROLLER_USERNAME&quot; --data-urlencode &quot;password=$ENROLLER_PASSWORD&quot; | jq -r .access_token)
</code></pre></div></p>
</li>
<li>
<p><strong>Admin</strong> - Get all the provisioned CAs
  <div class="highlight"><pre><span></span><code>CAS=$(curl -k &quot;https://$DOMAIN/api/ca/v1/pki&quot; --header &quot;Authorization: Bearer $ENROLLER_TOKEN&quot; | jq .cas[].name | jq -s)
</code></pre></div></p>
</li>
<li>
<p><strong>Operator</strong> - Request the registration for a new DMS instance:
  <div class="highlight"><pre><span></span><code>DMS_NAME=HostCloudDMS
DMS_SUBJECT_COUNTRY=ES
DMS_SUBJECT_STATE=Gipuzkoa
DMS_SUBJECT_LOCALITY=Donostia
DMS_SUBJECT_ORGANIZATION=Lamassu
DMS_SUBJECT_ORGANIZATION_UNIT=IoT
</code></pre></div>
  <div class="highlight"><pre><span></span><code>DMS_REG_RESPONSE=$(curl -k --location --request POST &quot;https://$DOMAIN/api/dmsmanager/v1/&quot; \
--header &quot;Authorization: Bearer $OPERATOR_TOKEN&quot; \
--data-raw &quot;{\&quot;key_metadata\&quot;: {\&quot;bits\&quot;:3072, \&quot;type\&quot;:\&quot;RSA\&quot;}, \&quot;subject\&quot;:{\&quot;common_name\&quot;:\&quot;$DMS_NAME\&quot;, \&quot;country\&quot;:\&quot;$DMS_SUBJECT_COUNTRY\&quot;,\&quot;locality\&quot;:\&quot;$DMS_SUBJECT_LOCALITY\&quot;,\&quot;organization\&quot;:\&quot;$DMS_SUBJECT_ORGANIZATION\&quot;,\&quot;organization_unit\&quot;:\&quot;$DMS_SUBJECT_ORGANIZATION_UNIT\&quot;,\&quot;state\&quot;:\&quot;$DMS_SUBJECT_STATE\&quot;}, \&quot;host_cloud_dms\&quot;:true, \&quot;bootstrap_cas\&quot;:$CAS }&quot;)

DMS_NAME=$(echo $DMS_REG_RESPONSE | jq -r .dms.name)
echo $DMS_REG_RESPONSE | jq -r .private_key | base64 -d &gt; dms.key
</code></pre></div></p>
</li>
<li><strong>Admin</strong> - Authenticate the admin user
  <div class="highlight"><pre><span></span><code>ENROLLER_TOKEN=$(curl -k -s --location --request POST &quot;https://auth.$DOMAIN/auth/realms/lamassu/protocol/openid-connect/token&quot; --header &#39;Content-Type: application/x-www-form-urlencoded&#39; --data-urlencode &#39;grant_type=password&#39; --data-urlencode &#39;client_id=frontend&#39; --data-urlencode &quot;username=$ENROLLER_USERNAME&quot; --data-urlencode &quot;password=$ENROLLER_PASSWORD&quot; | jq -r .access_token)
</code></pre></div></li>
<li><strong>Admin</strong> - Authorize the enrollment with all the provisioned CAs
  <div class="highlight"><pre><span></span><code>AUTHORIZED_CAS=$(curl -k &quot;https://$DOMAIN/api/ca/v1/pki&quot; --header &quot;Authorization: Bearer $ENROLLER_TOKEN&quot; | jq .cas[].name | jq -s)
</code></pre></div>
  <div class="highlight"><pre><span></span><code>curl -k --location --request PUT &quot;https://$DOMAIN/api/dmsmanager/v1/$DMS_NAME/status&quot; \
--header &quot;Authorization: Bearer $ENROLLER_TOKEN&quot; \
--data-raw &quot;{\&quot;status\&quot;:\&quot;APPROVED\&quot;}&quot;
</code></pre></div>
  <div class="highlight"><pre><span></span><code>AUTHORIZED_CA=$(echo $AUTHORIZED_CAS | jq .[0] -r)
</code></pre></div>
  <div class="highlight"><pre><span></span><code>curl -k --location --request PUT &quot;https://$DOMAIN/api/dmsmanager/v1/$DMS_NAME/auth&quot; \
--header &quot;Authorization: Bearer $ENROLLER_TOKEN&quot; \
--data-raw &quot;{\&quot;authorized_cas\&quot;:[\&quot;$AUTHORIZED_CA\&quot;]}&quot;
</code></pre></div></li>
<li><strong>Operator</strong> - Get the DMS certificate:
  <div class="highlight"><pre><span></span><code>curl -k &quot;https://$DOMAIN/api/dmsmanager/v1/$DMS_NAME&quot; --header &quot;Authorization: Bearer $OPERATOR_TOKEN&quot; | jq -r .certificate | base64 -d &gt; dms.crt 
</code></pre></div></li>
</ol>
<h3 id="provision-your-devices-with-x509-certificates">Provision your devices with x509 Certificates</h3>
<p>The enrollment process is the way to go to obtain a certificate issued by one of the provisioned CAs. As described in the RFC document, Lamassu requires the authentication of the client requesting the enrollment using a certificate as well as the private key of an issued DMS to perform a mutual TLS connection. By using this type of TLS connection, the client is able to authenticate the server, and also, the server is able to authenticate the client.</p>
<p>Although the <code>/api/devmanager/.well-known/cacerts</code> endpoint returns the list containing all the manged CAs by the PKI, each DMS is entitled to request the issuance of a certificate with an authorized CA. For instance, the PKI may have the following CAs: <code>CA1</code>, <code>CA2</code>, <code>CA3</code> and <code>CA4</code>. The <code>/api/devmanager/.well-known/cacerts</code> would return all four CAs. Then, a new DMS is registered. the PKI administrator approves the DMS registration by authorizing such DMS to issue certificates with <code>CA1</code> and <code>CA4</code>. This process is known as the <em>DMS registration process</em>. Once the DMS is completely registered, it can now start performing the EST enrollment process. Check out the <a href="#register-a-new-device-manufacturing-system">previous section</a> to understand what a DMS does.</p>
<p>Let's first obtain the CA list for a particular DMS:</p>
<h4 id="manual-dms_1">Manual DMS</h4>
<ol>
<li>
<p>First, authenticate and obtain a valid JWT
  <div class="highlight"><pre><span></span><code>OPERATOR_USERNAME=operator
OPERATOR_PASSWORD=operator
DOMAIN=dev.lamassu.io
</code></pre></div>
  <div class="highlight"><pre><span></span><code>OPERATOR_TOKEN=$(curl -k -s --location --request POST &quot;https://auth.$DOMAIN/auth/realms/lamassu/protocol/openid-connect/token&quot; --header &#39;Content-Type: application/x-www-form-urlencoded&#39; --data-urlencode &#39;grant_type=password&#39; --data-urlencode &#39;client_id=frontend&#39; --data-urlencode &quot;username=$OPERATOR_USERNAME&quot; --data-urlencode &quot;password=$OPERATOR_PASSWORD&quot; | jq -r .access_token)
</code></pre></div></p>
</li>
<li>
<p>Obtain the CA list:
  <div class="highlight"><pre><span></span><code>ENTITLED_CAS=$(curl -k --location --request GET &quot;https://$DOMAIN/api/dmsmanager/v1/$DMS_NAME&quot; --header &quot;Authorization: Bearer $OPERATOR_TOKEN&quot; | jq .authorized_cas)
</code></pre></div></p>
</li>
<li>
<p>Select one of the entitled the CAs from the previous list:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can manually spefify the <code>SELECTED_CA</code>. Otherwise you can enroll the device with the first entitled CA using the following command.</p>
</div>
<div class="highlight"><pre><span></span><code>SELECTED_CA=$(echo $ENTITLED_CAS | jq .[0] -r)
</code></pre></div>
</li>
<li>
<p>Generate the device CSR:
  <div class="highlight"><pre><span></span><code>DEVICE_ID=mytestdevice-123
</code></pre></div>
  <div class="highlight"><pre><span></span><code>openssl req -new -newkey rsa:2048 -nodes -keyout device.key -out device.csr -outform DER -subj &quot;/CN=$DEVICE_ID&quot;

openssl base64 -in device.csr -out device.b64 -e
</code></pre></div></p>
</li>
<li>
<p>Enroll the device:
  <div class="highlight"><pre><span></span><code>DMS_CRT_PATH=path/to/dms_crt
DMS_KEY_PATH=path/to/dms_key
</code></pre></div>
  <div class="highlight"><pre><span></span><code>openssl s_client -connect $DOMAIN:443 2&gt;/dev/null &lt;/dev/null |  sed -ne &#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p&#39; &gt; root-ca.pem

curl https://$DOMAIN/api/devmanager/.well-known/est/$SELECTED_CA/simpleenroll --cert $DMS_CRT_PATH --key $DMS_KEY_PATH -s -o device-cert.p7 --cacert root-ca.pem  --data @device.b64 -H &quot;Content-Type: application/pkcs10&quot; -H &quot;Content-Transfer-Encoding: base64&quot;

openssl base64 -d -in device-cert.p7 | openssl pkcs7 -inform DER -outform PEM -print_certs -out device-cert.pem 

openssl x509 -text -in device-cert.pem
</code></pre></div></p>
</li>
</ol>
<h4 id="cloud-hosted-dms_1">Cloud Hosted DMS</h4>
<ol>
<li>
<p>First, authenticate and obtain a valid JWT
  <div class="highlight"><pre><span></span><code>ENROLLER_USERNAME=enroller
ENROLLER_PASSWORD=enroller
DOMAIN=dev.lamassu.io
</code></pre></div>
  <div class="highlight"><pre><span></span><code>ENROLLER_TOKEN=$(curl -k -s --location --request POST &quot;https://auth.$DOMAIN/auth/realms/lamassu/protocol/openid-connect/token&quot; --header &#39;Content-Type: application/x-www-form-urlencoded&#39; --data-urlencode &#39;grant_type=password&#39; --data-urlencode &#39;client_id=frontend&#39; --data-urlencode &quot;username=$ENROLLER_USERNAME&quot; --data-urlencode &quot;password=$ENROLLER_PASSWORD&quot; | jq -r .access_token)
</code></pre></div></p>
</li>
<li>
<p>Obtain the Bootstrap CA list:
  <div class="highlight"><pre><span></span><code>ENTITLED_CAS=$(curl -k --location --request GET &quot;https://$DOMAIN/api/dmsmanager/v1/$DMS_NAME&quot; --header &quot;Authorization: Bearer $OPERATOR_TOKEN&quot; | jq .bootstrap_cas)
</code></pre></div></p>
</li>
<li>
<p>Select one of the entitled the CAs from the previous list:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can manually spefify the <code>BOOTSTRAP_CA</code>. </p>
</div>
<div class="highlight"><pre><span></span><code>BOOTSTRAP_CA=$(echo $ENTITLED_CAS | jq .[0] -r)
</code></pre></div>
</li>
<li>
<p>Generate the Bootstrap CSR:
  <div class="highlight"><pre><span></span><code>DEVICE_ID=bootstrap
</code></pre></div>
  <div class="highlight"><pre><span></span><code>openssl req -new -newkey rsa:2048 -nodes -keyout bootstrap.key -out bootstrap.csr -subj &quot;/CN=$DEVICE_ID&quot;
</code></pre></div></p>
</li>
<li>
<p><strong>Admin</strong> - Authenticate the admin user
    <div class="highlight"><pre><span></span><code>ENROLLER_TOKEN=$(curl -k -s --location --request POST &quot;https://auth.$DOMAIN/auth/realms/lamassu/protocol/openid-connect/token&quot; --header &#39;Content-Type: application/x-www-form-urlencoded&#39; --data-urlencode &#39;grant_type=password&#39; --data-urlencode &#39;client_id=frontend&#39; --data-urlencode &quot;username=$ENROLLER_USERNAME&quot; --data-urlencode &quot;password=$ENROLLER_PASSWORD&quot; | jq -r .access_token)
</code></pre></div></p>
</li>
<li>
<p><strong>Admin</strong> - Get Bootstrap Certificate
  <div class="highlight"><pre><span></span><code>openssl s_client -connect $DOMAIN:443 2&gt;/dev/null &lt;/dev/null |  sed -ne &#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p&#39; &gt; root-ca.pem

CSR_B64=$(openssl base64 -in bootstrap.csr -e | tr -d [:space:])

BOOTSTRAP_CERT=$(curl -k --location --request POST &quot;https://$DOMAIN/api/ca/v1/pki/$BOOTSTRAP_CA/sign&quot; --header &quot;Authorization: Bearer $ENROLLER_TOKEN&quot; --data-raw &quot;{\&quot;certificate_request\&quot;:\&quot;$CSR_B64\&quot;, \&quot;common_name\&quot;:\&quot;bootstrap\&quot;,\&quot;sign_verbatim\&quot;:true}&quot;)

echo $BOOTSTRAP_CERT | jq -r .certificate | base64 -d &gt; bootstrap.crt 
</code></pre></div></p>
</li>
<li>
<p>Enroll the device:
  <div class="highlight"><pre><span></span><code>DEVICE_ID=mytestdevice-123
</code></pre></div>
  <div class="highlight"><pre><span></span><code>openssl req -new -newkey rsa:2048 -nodes -keyout device.key -out device.csr -outform DER -subj &quot;/CN=$DEVICE_ID&quot;

openssl base64 -in device.csr -out device.b64 -e
</code></pre></div>
  <div class="highlight"><pre><span></span><code>BOOTSTRAP_CRT_PATH=path/to/dms_crt
BOOTSTRAP_KEY_PATH=path/to/dms_key
</code></pre></div>
  <div class="highlight"><pre><span></span><code>openssl s_client -connect $DOMAIN:443 2&gt;/dev/null &lt;/dev/null |  sed -ne &#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p&#39; &gt; root-ca.pem

curl https://$DOMAIN/api/dmsmanager/.well-known/est/$DMS_NAME/simpleenroll --cert $BOOTSTRAP_CRT_PATH --key $BOOTSTRAP_KEY_PATH -s -o device-cert.p7 --cacert root-ca.pem  --data @device.b64 -H &quot;Content-Type: application/pkcs10&quot; -H &quot;Content-Transfer-Encoding: base64&quot;

openssl base64 -d -in device-cert.p7 | openssl pkcs7 -inform DER -outform PEM -print_certs -out device-cert.pem 

openssl x509 -text -in device-cert.pem
</code></pre></div></p>
</li>
</ol>
<h2 id="using-the-ui">Using the UI</h2>
<p>The UI is an easy manageable tool designed to ease the burdens to non-technical users in using Lamassu PKI. This project was bootstrapped with <a href="https://github.com/facebook/create-react-app">Create React App</a>.</p>
<p>You can learn more in the <a href="https://facebook.github.io/create-react-app/docs/getting-started">Create React App documentation</a>.</p>
<p><img alt="Screenshot" src="../img/lamassu-app.png#only-light" /></p>
<h3 id="deployment">Deployment</h3>
<p>This section has moved here: <a href="https://facebook.github.io/create-react-app/docs/deployment">https://facebook.github.io/create-react-app/docs/deployment</a></p>
<h3 id="create-a-new-certification-authority_1">Create a new Certification Authority</h3>
<p>There are two methos of creating a new CA from the UI.</p>
<p>The first one, filling the following form taking into account the following things:</p>
<ul>
<li>Lamassu supports both <code>RSA</code> and <code>EC</code> based CAs.</li>
<li>The CA name MUST be unique.</li>
<li>The CA expiration time must be greater than the lifespan of the issued certs.</li>
</ul>
<p><img alt="" src="../img/ca-registration.png" />
<img alt="" src="../img/ca-info.png" /> </p>
<p>The other one, will be importing it. A Certificate and a Private Key will be required.</p>
<p><img alt="" src="../img/ca-import.png" /> </p>
<h3 id="registration-of-a-dms-using-the-ui">Registration of a DMS using the UI</h3>
<p>Using the UI, creating a new DMS is as simple as filling the following form. </p>
<p><img alt="Screenshot" src="../img/dms-registration.png#only-light" /></p>
<p>Once the DMS has been created successfully, a prompt showing the generated private key will be shown. It is encouraged to download it just after the creation as this prompt will be shown only once.</p>
<p><img alt="Screenshot" src="../img/pk.PNG#only-light" /></p>
<p>The status of the new created DMS will be <code>Pending Approval</code>, to approve it, we must select at least one CA from the list of registered CAs. The selected CAs will be the authorised ones to sign certificates from now on. </p>
<p><img alt="Screenshot" src="../img/dms-authroization-cas.png#only-light" /></p>
<p><img alt="Screenshot" src="../img/dms-list.png#only-light" /></p>
<h3 id="registration-of-a-device-using-the-ui">Registration of a device using the UI</h3>
<p>To create a device, we will need to fill the following form taking into account:</p>
<ul>
<li>A device identification must be provided.</li>
<li>A DMS must be assigned.</li>
</ul>
<p><img alt="Screenshot" src="../img/device-register.PNG#only-light" /></p>
<p>Each device can have certificates signed by different authorised CAs.</p>
<p><img alt="Screenshot" src="../img/device-slots.png#only-light" /></p>
<p>The certificates of each device as well as the cloud-connectors will be showned.</p>
<p><img alt="Screenshot" src="../img/device-info.png#only-light" /></p>
<h2 id="using-the-apis">Using the APIs</h2>
<p>The main 3 Open API documentation can be found on the following urls:</p>
<ul>
<li><a href="https://dev.lamassu.io/api/dmsmanager/v1/docs/">https://dev.lamassu.io/api/dmsmanager/v1/docs/</a></li>
<li><a href="https://dev.lamassu.io/api/ca/v1/docs/">https://dev.lamassu.io/api/ca/v1/docs/</a></li>
<li><a href="https://dev.lamassu.io/api/devmanager/v1/docs/">https://dev.lamassu.io/api/devmanager/v1/docs/</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following endpoints defined in the Lamassu Device Manager Api specification are not correctly defined due to the limitations imposed by the Open API 3.0 schema. The current specification defines an <code>OIDC</code> security schema (meaning that a valid JWT token must be provided while requesting the API) while the implemented security schema uses the <code>mTLS</code> approach. This issue will be resolved once the specification is migrated to Open API 3.1 compliant. The affected endpoints are:
<img alt="Screenshot" src="../img/missing-mtls-openapi.png" /></p>
</div>
<p>Lamassu provides easy to use GO clients for most of its APIs to help speeding up the development of third-party applications. Before using thees clients, it is important to identify the path taken by the request. Unless the application using the GO clients (or any other http client such as <code>curl</code>) is deployed within the same docker network, the request will be <a href="#through-the-api-gateway">handled by the API Gateway component</a>. Otherwise check the <a href="#internal-usage">internal usage</a> section.</p>
<h3 id="through-the-api-gateway">Through the API Gateway</h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Go</label><label for="__tabbed_1_2">Curl</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="s">&quot;net/url&quot;</span><span class="w"></span>
<span class="nx">lamassuCAClient</span><span class="w"> </span><span class="s">&quot;github.com/lamassuiot/lamassuiot/pkg/ca/client&quot;</span><span class="w"></span>
<span class="nx">caDTO</span><span class="w"> </span><span class="s">&quot;github.com/lamassuiot/lamassuiot/pkg/ca/common/dto&quot;</span><span class="w"></span>
<span class="s">&quot;github.com/lamassuiot/lamassuiot/pkg/utils/client&quot;</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="nx">function</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="p">(){</span><span class="w"></span>
<span class="w">    </span><span class="nx">lamassuGatewayURL</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;dev.lamassu.io&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nx">apiCAFile</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;path/to/apigw.crt&quot;</span><span class="w"></span>

<span class="w">    </span><span class="nx">caClient</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">lamassuCAClient</span><span class="p">.</span><span class="nx">NewLamassuCAClient</span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">ClientConfiguration</span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">URL</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">url</span><span class="p">.</span><span class="nx">URL</span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">Scheme</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nx">Host</span><span class="p">:</span><span class="w">   </span><span class="nx">lamassuGatewayURL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nx">Path</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;/api/ca/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="nx">AuthMethod</span><span class="p">:</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">JWT</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">AuthMethodConfig</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">client</span><span class="p">.</span><span class="nx">JWTConfig</span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">Username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;enroller&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nx">Password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;enroller&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nx">URL</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">url</span><span class="p">.</span><span class="nx">URL</span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="nx">Scheme</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="nx">Host</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;auth.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">lamassuGatewayURL</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="nx">CACertificate</span><span class="p">:</span><span class="w"> </span><span class="nx">apiCAFile</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="nx">CACertificate</span><span class="p">:</span><span class="w"> </span><span class="nx">apiCAFile</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>

<span class="w">    </span><span class="nx">ca</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">caClient</span><span class="p">.</span><span class="nx">CreateCA</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">caDTO</span><span class="p">.</span><span class="nx">Pki</span><span class="p">,</span><span class="w"> </span><span class="nx">caName</span><span class="p">,</span><span class="w"> </span><span class="nx">caDTO</span><span class="p">.</span><span class="nx">PrivateKeyMetadata</span><span class="p">{</span><span class="nx">KeyType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;rsa&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">KeyBits</span><span class="p">:</span><span class="w"> </span><span class="mi">2048</span><span class="p">},</span><span class="w"> </span><span class="nx">caDTO</span><span class="p">.</span><span class="nx">Subject</span><span class="p">{</span><span class="nx">CN</span><span class="p">:</span><span class="w"> </span><span class="nx">caName</span><span class="p">},</span><span class="w"> </span><span class="mi">365</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Define the DOMAIN, TOKEN and CA_NAME
    <div class="highlight"><pre><span></span><code>export AUTH_ADDR=auth.$DOMAIN 
export TOKEN=$(curl -k --location --request POST &quot;https://$AUTH_ADDR/auth/realms/lamassu/protocol/openid-connect/token&quot; --header &#39;Content-Type: application/x-www-form-urlencoded&#39; --data-urlencode &#39;grant_type=password&#39; --data-urlencode &#39;client_id=frontend&#39; --data-urlencode &#39;username=enroller&#39; --data-urlencode &#39;password=enroller&#39; | jq -r .access_token)
export CA_ADDR=$DOMAIN/api/ca
export CA_NAME=$(uuidgen)
</code></pre></div>
Creting CA
    <div class="highlight"><pre><span></span><code>export CREATE_CA_RESP=$(curl -k -s --location --request POST &quot;https://$CA_ADDR/v1/pki&quot; --header &quot;Authorization: Bearer ${TOKEN}&quot; --header &#39;Content-Type: application/json&#39; --data-raw &quot;{\&quot;ca_duration\&quot;: 262800, \&quot;issuance_duration\&quot;: 175200, \&quot;subject\&quot;:{ \&quot;common_name\&quot;: \&quot;$CA_NAME\&quot;,\&quot;country\&quot;: \&quot;ES\&quot;,\&quot;locality\&quot;: \&quot;Arrasate\&quot;,\&quot;organization\&quot;: \&quot;LKS Next, S. Coop\&quot;,\&quot;state\&quot;: \&quot;Gipuzkoa\&quot;},\&quot;key_metadata\&quot;:{\&quot;bits\&quot;: 4096,\&quot;type\&quot;: \&quot;RSA\&quot;}}&quot;)
</code></pre></div></p>
</div>
</div>
</div>
<h2 id="running-unit-tests">Running Unit tests</h2>
<div class="highlight"><pre><span></span><code>#For pretty printing
go install github.com/haveyoudebuggedit/gotestfmt/v2/cmd/gotestfmt@v2.3.1


go test -json -v ./pkg/ca/server/api/ | gotestfmt
go test -json -v ./pkg/dms-manager/server/api/ | gotestfmt
go test -json -v ./pkg/device-manager/server/api/ | gotestfmt
</code></pre></div>
<h4 id="filtering-sorting-and-pagination">Filtering, Sorting and Pagination</h4>
<p>Lamassu API supports filtering, sorting and pagination.</p>
<p>The filter can be form by the following parameters, being each of them optional:</p>
<ul>
<li><code>filter= attribute[operator]=value</code></li>
<li><code>sort_by=attribute.[asc|desc]</code></li>
<li><code>limit=value</code> . Limits the maximun number of results of the query</li>
<li><code>offset=value</code> . In addition to <code>limit</code>, implements pagination. It defines the index of the first value from the resulting query.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code> /v1/devices?filter=id[contains]=device_id&amp;sort_by=id.asc&amp;limit=100&amp;offset=15

 /v1?filter=id[contains]=dms_id&amp;sort_by=id.desc
</code></pre></div>
</div>
<h5 id="operators">Operators</h5>
<p>Depending of the data type of the parameters, the supported operators will vary.</p>
<ul>
<li>Strings : <code>equals</code>, <code>notequals</code>, <code>contains</code>, <code>notcontains</code></li>
<li>Dates: <code>before</code>, <code>after</code>, <code>is</code>, <code>isnot</code></li>
<li>Enums: <code>is</code>, <code>isnot</code></li>
<li>Numbers: <code>lessthan</code>, <code>greaterthan</code>, <code>lessorequal</code>, <code>gretaerorequal</code>, <code>equal</code>, <code>notequal</code></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../setup/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Setup" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Setup
            </div>
          </div>
        </a>
      
      
        
        <a href="../protocols/" class="md-footer__link md-footer__link--next" aria-label="Next: Protocols" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Protocols
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/lamassuiot" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://hub.docker.com/u/lamassuiot" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/lamassuiot" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>