
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../simple-config-scenarios/">
      
      
        <link rel="next" href="../../../basic-features/ca-service/">
      
      
      <link rel="icon" href="../../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.20">
    
    
      
        <title>Subsytem config - Lamassu IoT Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/scheme.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="lamassu" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Lamassu IoT Docs" class="md-header__button md-logo" aria-label="Lamassu IoT Docs" data-md-component="logo">
      
  <img src="../../../img/lamassu.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lamassu IoT Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Subsytem config
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="lamassu" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lamassuiot/lamassu-helm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Helm Chart
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Lamassu IoT Docs" class="md-nav__button md-logo" aria-label="Lamassu IoT Docs" data-md-component="logo">
      
  <img src="../../../img/lamassu.svg" alt="logo">

    </a>
    Lamassu IoT Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lamassuiot/lamassu-helm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Helm Chart
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to Lamassu Iot Docs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced Configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helm-chart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Helm Chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simple-config-scenarios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common configuration Scenarios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Subsytem config
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Subsytem config
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#databases" class="md-nav__link">
    <span class="md-ellipsis">
      Databases
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Databases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#couchdb" class="md-nav__link">
    <span class="md-ellipsis">
      CouchDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aws-dynamodb" class="md-nav__link">
    <span class="md-ellipsis">
      AWS DynamoDB
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-messaging" class="md-nav__link">
    <span class="md-ellipsis">
      Async Messaging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async Messaging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rabbitmq" class="md-nav__link">
    <span class="md-ellipsis">
      RabbitMQ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keycloak" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aws-cognito" class="md-nav__link">
    <span class="md-ellipsis">
      AWS Cognito
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Service Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Service Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic-features/ca-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CA Service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic-features/dms-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DMS Service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic-features/device-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Device Service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic-features/va-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VA Service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic-features/alerts-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Alerts Service
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#databases" class="md-nav__link">
    <span class="md-ellipsis">
      Databases
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Databases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#couchdb" class="md-nav__link">
    <span class="md-ellipsis">
      CouchDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aws-dynamodb" class="md-nav__link">
    <span class="md-ellipsis">
      AWS DynamoDB
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-messaging" class="md-nav__link">
    <span class="md-ellipsis">
      Async Messaging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async Messaging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rabbitmq" class="md-nav__link">
    <span class="md-ellipsis">
      RabbitMQ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keycloak" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aws-cognito" class="md-nav__link">
    <span class="md-ellipsis">
      AWS Cognito
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Subsytem config</h1>

<h2 id="configuration">Configuration</h2>
<h3 id="databases">Databases</h3>
<p>Lamassu Core services have been designed in such a way to enable different storage engines. Each engine has its own set of pros and cons depending, and there is
no easy way of determining the best candidate. Each scenario is unique in terms of data volume, availability requirements or even pricing requirements in case
of delegating on any cloud provider.</p>
<h4 id="postgres">Postgres</h4>
<p>The main Database for the current Lamassu version is postgres. You can provide any Postgres DB instance such as a HA Postgres deployment, an AWS RDS DB with
postgres driver or similar alternatives. Note that each lamassu service expects it's own DB within the DB instance. As such, the deployed postgres instance must
include the following DBs: <code>alerts</code>, <code>ca</code>, <code>cloudproxy</code>, <code>devicemanager</code>, <code>dmsmanager</code>. Additionally if Keycloak is used as the authentication service, the DB
instance must also supply the <code>auth</code> DB.</p>
<p>The following Postgres Single-Node deployment configuration is only meant for testing purposes and should not be used in a production environment as it doesn't
follow best practices such as using unsafe password credentials</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">cat &gt; postgres.yaml &lt;&lt; &quot;EOF&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">fullnameOverride</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;postgresql&quot;</span>
<span class="nt">global</span><span class="p">:</span>
<span class="w">  </span><span class="nt">postgresql</span><span class="p">:</span>
<span class="w">    </span><span class="nt">auth</span><span class="p">:</span><span class="w"> </span><span class="c1">#(1)</span>
<span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="nt">primary</span><span class="p">:</span>
<span class="w">  </span><span class="nt">initdb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scripts</span><span class="p">:</span>
<span class="w">      </span><span class="nt">init.sql</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">CREATE DATABASE auth;</span>
<span class="w">        </span><span class="no">CREATE DATABASE alerts;</span>
<span class="w">        </span><span class="no">CREATE DATABASE ca;</span>
<span class="w">        </span><span class="no">CREATE DATABASE devicemanager;</span>
<span class="w">        </span><span class="no">CREATE DATABASE dmsmanager;</span>
<span class="l l-Scalar l-Scalar-Plain">EOF</span>
</code></pre></div>
<ol>
<li>Place here the admin credentials provided during PostgreSQL configuration.</li>
</ol>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bitnami<span class="w"> </span>https://charts.bitnami.com/bitnami
helm<span class="w"> </span>install<span class="w"> </span>postgres<span class="w"> </span>bitnami/postgresql<span class="w"> </span>-f<span class="w"> </span>postgres.yaml
</code></pre></div>
<p>Lamassu's Helm chart allows specifying the connection parameters to be used by the different services by providing the following configuration in the
<code>values.yaml</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="nt">postgres</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;postgresql&quot;</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;admin&quot;</span><span class="w"> </span><span class="c1">#(1)</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;admin&quot;</span>
</code></pre></div>
<ol>
<li>Customize your admin credentials here</li>
</ol>
<h4 id="couchdb">CouchDB</h4>
<p>TODO: Future versions will include support for CouchDB as the Storage Engine</p>
<h4 id="aws-dynamodb">AWS DynamoDB</h4>
<p>TODO: Future versions will include support for DynamoDB as the Storage Engine</p>
<h3 id="async-messaging">Async Messaging</h3>
<p>As of now, AMQP is the only Async Messaging engine supported. The Async Messaging engine service a crucial role for sending PKI related events in real time.
Check out all the events generated by Lamassu services in the <a href="/apis/cloud-events">Cloud Events</a> section.</p>
<h4 id="rabbitmq">RabbitMQ</h4>
<p>RabbitMQ is perhaps the most popular AMQP service, and its deployment for a test scenario is quite straight forward.</p>
<p>Start by deploying RabbitMQ with your own configuration. This section contains a basic configuration deployment and it should not be used in any production
environment as it is due to insecure configurations (like non robust credentials for instance):</p>
<div class="highlight"><pre><span></span><code><span class="nt">fullnameOverride</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;rabbitmq&quot;</span>
<span class="nt">auth</span><span class="p">:</span><span class="w"> </span><span class="c1">#(1)</span>
<span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user&quot;</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user&quot;</span>
</code></pre></div>
<ol>
<li>Place here the admin credentials provided during RabitMQ configuration.</li>
</ol>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bitnami<span class="w"> </span>https://charts.bitnami.com/bitnami
helm<span class="w"> </span>install<span class="w"> </span>rabbitmq<span class="w"> </span>bitnami/rabbitmq<span class="w"> </span>-f<span class="w"> </span>rabbitmq.yaml
</code></pre></div>
<p>Lamassu's Helm chart allows specifying the connection parameters to be used by the different services by providing the following configuration in the
<code>values.yaml</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="nt">amqp</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;rabbitmq&quot;</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5672</span>
<span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="w"> </span><span class="c1">#(1)</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user&quot;</span>
<span class="w">  </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<ol>
<li>Customize your admin credentials here</li>
</ol>
<h3 id="authentication">Authentication</h3>
<h4 id="keycloak">Keycloak</h4>
<p>Keycloak is an open-source identity and access management (IAM) solution developed by Red Hat. It provides a set of features and capabilities to handle user
authentication, authorization, and identity management in web and mobile applications.</p>
<p>As of now, lamassu integrates this component while deploying Lamassu's own helm chart. By default it is deployed on all instances, but can be disabled if
another OIDC based provider is configured.</p>
<p>To disable keycloak in a lamassu installation, provide the following <code>values.yaml</code> file containing:</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">keycloack</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<p>If instead you choose to go with the default installation and use Keycloak as your IAM OIDC-based provider, include the following section in your <code>values.yaml</code>
file:</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">keycloack</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/lamassuiot/keycloak:2.1.0</span>
<span class="w">    </span><span class="nt">adminCreds</span><span class="p">:</span><span class="w"> </span><span class="c1"># (1)</span>
<span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;admin-user&gt;&quot;</span>
<span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;admin-password&gt;&quot;</span>
</code></pre></div>
<ol>
<li>Set here the credentials of the root admin user for the Keycloak instalation.</li>
</ol>
<p>The Keycloak Admin user credentials to be created should be specified in this section. This user is required to create Lamassu IoT users after installation by
following the steps below:</p>
<ol>
<li>
<p><strong>Log in to the Keycloak Administration Console</strong>: Open your web browser and navigate to the Keycloak Administration Console at
    <code>https://&lt;lamasu-domain&gt;/auth/admin</code>. Log in with your administrator credentials. These credentials has been provided during the helm chart configuration.</p>
</li>
<li>
<p><strong>Select the "lamassu" Realm</strong>: After logging in, use the dropdown menu in the top left corner to select the <code>lamassu</code> realm. This will take you to the realm
    where you want to create the user.</p>
</li>
<li>
<p><strong>Navigate to the "Users" Section</strong>: In the left-hand sidebar, locate and click on the "Users" option. Here, you'll see a list of existing users in the
    <code>lamassu</code> realm.</p>
</li>
<li>
<p><strong>Create a New User</strong>: To create a new user, click the "Add User" button. This will open a form where you can configure the details of the new user.</p>
</li>
<li>
<p><strong>Configure User Details</strong>: In the user creation form, provide information such as the username, full name, email. Click on the create button.</p>
</li>
<li>
<p><strong>Set User Credentials</strong>: In the "Credentials" tab, set the user's password.</p>
</li>
<li>
<p><strong>Assign the "pki-admin" Role</strong>: To assign the <code>pki-admin</code> role to the user, go to the "Role Mappings" tab. Click on "Assing role", find and select
    the "pki-admin" role and move it to the "Assigned Roles" list. This will grant the user the <code>pki-admin</code> role.</p>
</li>
<li>
<p><strong>Login with the new user</strong>: Once you've configured the user navigate to the Lamassu IoT console URL <code>https://&lt;lamasu-domain&gt;</code> and provide the user credentials.</p>
</li>
</ol>
<p>The new user is now created and has been assigned the <code>pki-admin</code> role in the <code>lamassu</code> realm. Ensure that the user has the appropriate roles and permissions as
per your security and access requirements.</p>
<h4 id="aws-cognito">AWS Cognito</h4>
<p>Amazon Cognito is a fully managed identity and user management service provided by AWS that simplifies the process of adding user sign-up, sign-in, and
authentication to web and mobile applications. It is a comprehensive identity and access management (IAM) solution that is designed to help developers secure
their applications by handling the user management and authentication aspects.</p>
<p>Start by creating going to AWS Console and create a new Cognito user pool in case you don't already have one. As can be seen in the image below, in this case
the user pool has been named lamassu-oidc.</p>
<p><img alt="Screenshot" src="../imgs/user-pools.png" /></p>
<div class="admonition info">
<p class="admonition-title">Lamassu Helm Chart</p>
<p>Make sure to copy the <strong>user pool ID</strong> assigned by AWS as it will be needed while configuring the Lamassu's Helm Chart. Note that the user pool ID is
different than the assigned name.</p>
</div>
<p>Cognito provides a mechanism that assigns a <em>friendly</em> URL when a user is redirected to cognito to sign in. Go to <code>App Integration &gt; Domain &gt; Actions</code> and
select <code>Create Cognito Domain</code> and provide a valid name. Note that the name must be unique within the same AWS region.</p>
<p><img alt="Screenshot" src="../imgs/cognito-domain.png" /></p>
<p>Optionally, it is possible to customize the sign in page with some custom CSS and a logo image. To do so, go to <code>App Integration &gt; Hosted UI customization</code> For
instance you can configure Cognito to use the following <a href="../imgs/hosted-ui-logo.jpeg">Image (click to open)</a> as the main logo displayed when a user is redirected
to sign in.</p>
<p>To instruct Cognito to display the main logo, use the following css:</p>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="nc">logo-customizable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">  </span><span class="k">max-height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">banner-customizable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#007ACC</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">submitButton-customizable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="kc">bold</span><span class="p">;</span>
<span class="w">  </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#007ACC</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">submitButton-customizable</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">gray</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Finally, and the most important part, is creating a new client application for lamassu within the user pool. Go to <code>App Integration &gt; App clients and analytics</code>
and create a new Client and configure as follows:</p>
<ul>
<li>App Client<ul>
<li>App type: Select <strong>Public Client</strong></li>
<li>App client name: Specify a friendly name for the app client. i.e.: <code>lamassu-ui</code></li>
</ul>
</li>
<li>Hosted UI settings<ul>
<li>Allowed callback URLs: This is a key parameter. Bare in mind the <strong>URL</strong> used to access lamassu's UI. If you access the UI at <code>https://dev.lamassu.io</code> then
    configure such url to be allowed to sign in</li>
<li>Allowed sign-out URLs: Use the same URL as the allowed callback URL but appending <code>/loggedout</code> at the end. i.e.: <code>https://dev.lamassu.io/loggedout</code></li>
</ul>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Lamassu Helm Chart - <code>services.auth.oidc.clientId</code></p>
<p>Make sure to copy the App Client ID assigned by AWS as it will be needed while configuring the Lamassu's Helm Chart. Note that the App Client ID is
different than the assigned name.</p>
</div>
<p>The last critical part for configuring Cognito is to define different user groups to limit what each user is allowed to do with lamassu. As of now, lamassu only
has two roles: <code>admin</code> and <code>operator</code>. In this example, we will group our user pool users in two cognito groups:</p>
<ul>
<li><code>pki-admin</code> group: the users that are assigned to this cognito group will have FULL access to all operations within Lamassu, so make sure to only assign
    authorized users.</li>
<li><code>audit</code> group: in contrast, this second group will have limited access.</li>
</ul>
<p>Create and assign the users within your cognito user pool under the <code>Groups</code> tab</p>
<div class="admonition info">
<p class="admonition-title">Lamassu Helm Chart</p>
<p>Note that we will map those groups into actual lamassu roles later on while configuring the helm chart under <code>services.auth.authorization</code></p>
</div>
<p>Configure Lamassu helm chart with the following section. Make sure to replace:</p>
<ul>
<li><code>COGNIT_AWS_REGION</code></li>
<li><code>COGNITO_HOSTED_UI_URL</code></li>
<li><code>COGNITO_USER_POOL_ID</code></li>
<li><code>COGNITO_CLIENT_ID</code></li>
</ul>
<p>As well as map the appropriate cognito groups under <code>services.auth.authorization</code></p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">keycloack</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">auth</span><span class="p">:</span>
<span class="w">  </span><span class="nt">oidc</span><span class="p">:</span>
<span class="w">    </span><span class="nt">frontend</span><span class="p">:</span>
<span class="w">      </span><span class="nt">authority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://cognito-idp.&lt;COGNIT_AWS_REGION&gt;.amazonaws.com/&lt;COGNITO_USER_POOL_ID&gt;</span>
<span class="w">      </span><span class="nt">clientId</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;COGNITO_CLIENT_ID&gt;</span>
<span class="w">      </span><span class="nt">awsCognito</span><span class="p">:</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">hostedUiDomain</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;COGNITO_HOSTED_UI_URL&gt;&quot;</span>
<span class="w">  </span><span class="nt">apiGateway</span><span class="p">:</span>
<span class="w">    </span><span class="nt">jwksUrl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://cognito-idp.&lt;COGNIT_AWS_REGION&gt;.amazonaws.com/&lt;COGNITO_USER_POOL_ID&gt;/.well-known/jwks.json</span>
<span class="w">  </span><span class="nt">authorization</span><span class="p">:</span>
<span class="w">    </span><span class="nt">rolesClaim</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cognito:groups&quot;</span>
<span class="w">    </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">      </span><span class="nt">admin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pki-admin</span>
<span class="w">      </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.dd8806f2.min.js"></script>
      
    
  </body>
</html>