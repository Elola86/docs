openapi: 3.1.0
info:
  version: 2.0.0-oas3.1
  title: 'Lamassu IoT: CA Service'
  description: >-
    The first step to provision devices with digital certificates is to create
    the Certification Authority. The role of a CA is to issue and manage all the
    certificates.


    Some useful links:

    - [Lamassu IoT Github repository](https://github.com/lamassuiot/lamassuiot)

    - [Lamassu Iot
    Docs](https://www.lamassu.io/docs/2.5.3/basic-features/ca-service/)
security:
  
tags:
  - name: CAs
  - name: certificates
  - name: engines
  - name: stats
paths:
  /cas:
    get:
      tags:
        - CAs
      summary: Get All CAs
      description: Get All CAs
      parameters: 
        - name: sort_by
          in: query
          description: Field by which to sort the results.
          required: false
          schema:
            type: string
            example: name
        - name: sort_mode
          in: query
          description: Sort mode, can be 'asc' for ascending or 'desc' for descending.
          required: false
          schema:
            type: string
            enum: [asc, desc]
            example: asc
        - name: page_size
          in: query
          description: Number of items per page.
          required: false
          schema:
            type: integer
            example: 5
        - name: bookmark
          in: query
          description: Bookmark for pagination.
          required: false
          schema:
            type: string
            example: "bm12345"
        - name: filter
          in: query
          description: |
            Filter criteria. Example format: field[operation]=value.
            Supported operations for string fields: eq (equal), ne (not equal), ct (contains), nc (not contains).
            Supported operations for date fields: bf (before), eq (equal), af (after).
            Supported operations for number fields: eq (equal), ne (not equal), lt (less than), le (less or equal), gt (greater than), ge (greater or equal).
          required: false
          schema:
            type: string
            example: status[eq]=active
      responses:
        '200':
          description: Successful operation. Returns all CAs.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetCAsResponse'
        '500':
          description: Something went wrong while getting all CAs.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
    post:
      tags:
        - CAs
      summary: Create CA
      description: Create CA
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCABody'
      responses:
        '201':
          description: Successfully created CA.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CACertificate'
        '400':
          description: >
            Bad Request. Possible error reasons: - Struct Validation error - CA
            type inconsistent - Issuance expiration greater than CA expiration -
            Incompatible expiration time ref
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                message: CA type inconsistent
        '409':
          description: Conflict - CA already exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/409Error'
              example:
                message: CA already exists
        '500':
          description: Something went wrong while creating a CA.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/import:
    post:
      tags:
        - CAs
      summary: Import CA
      description: Import CA
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImportCABody'
      responses:
        '201':
          description: Successfully imported CA.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportCAInput'
        '400':
          description: >
            Bad Request. Possible error reasons: - Struct Validation error - CA
            type inconsistent - Issuance expiration greater than CA expiration -
            Incompatible expiration time ref - CA and the provided key don't
            match
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                message: CA type inconsistent
        '500':
          description: Something went wrong while importing CA.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/{id}:
    get:
      tags:
        - CAs
      summary: Get CA By ID
      description: Get CA By ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the CA to retrieve.
      responses:
        '200':
          description: Successful operation. Returns the CA information.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CACertificate'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: CA not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: CA not found
        '500':
          description: Something went wrong while getting the CA.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
    delete:
      tags:
        - CAs
      summary: Delete CA
      description: Delete CA
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the CA to delete.
      responses:
        '201':
          description: CA successfully deleted.
        '400':
          description: Struct Validation error || CA Status inconsistent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: CA not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: CA not found
        '500':
          description: Something went wrong while deleting CA.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/cn/{cn}:
    get:
      tags:
        - CAs
      summary: Get CAs By Common Name
      description: Get CAs by their common name.
      parameters:
        - in: path
          name: cn
          required: true
          schema:
            type: string
          description: Common name of the CA(s) to retrieve.
        - name: sort_by
          in: query
          description: Field by which to sort the results.
          required: false
          schema:
            type: string
            example: name
        - name: sort_mode
          in: query
          description: Sort mode, can be 'asc' for ascending or 'desc' for descending.
          required: false
          schema:
            type: string
            enum: [asc, desc]
            example: asc
        - name: page_size
          in: query
          description: Number of items per page.
          required: false
          schema:
            type: integer
            example: 5
        - name: bookmark
          in: query
          description: Bookmark for pagination.
          required: false
          schema:
            type: string
            example: "bm12345"
        - name: filter
          in: query
          description: |
            Filter criteria. Example format: field[operation]=value.
            Supported operations for string fields: eq (equal), ne (not equal), ct (contains), nc (not contains).
            Supported operations for date fields: bf (before), eq (equal), af (after).
            Supported operations for number fields: eq (equal), ne (not equal), lt (less than), le (less or equal), gt (greater than), ge (greater or equal).
          required: false
          schema:
            type: string
            example: status[eq]=active
      responses:
        '200':
          description: Successful operation. Returns the list of CAs.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetCAsResponse'
        '500':
          description: Something went wrong while getting CAs.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/{id}/metadata:
    put:
      tags:
        - CAs
      summary: Update CA Metadata
      description: Update CA Metadata
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the CA to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                metadata:
                  type: object
                  additionalProperties: true
                  description: Metadata to update for the CA.
      responses:
        '200':
          description: Successful operation. Returns the CA information.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CACertificate'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: CA not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: CA not found
        '500':
          description: Something went wrong while updating CA.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/{id}/status:
    post:
      tags:
        - CAs
      summary: Update CA Status
      description: Update CA Status
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the CA to update.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCertificateStatusBody'
      responses:
        '201':
          description: Successful operation. Returns the CA information.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CACertificate'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: CA not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: CA not found
        '500':
          description: Something went wrong while updating CA.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/{id}/certificates:
    get:
      tags:
        - CAs
      summary: Get Certificates by CA
      description: Get Certificates by CA
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the CA certificates to retrieve.
        - name: sort_by
          in: query
          description: Field by which to sort the results.
          required: false
          schema:
            type: string
            example: name
        - name: sort_mode
          in: query
          description: Sort mode, can be 'asc' for ascending or 'desc' for descending.
          required: false
          schema:
            type: string
            enum: [asc, desc]
            example: asc
        - name: page_size
          in: query
          description: Number of items per page.
          required: false
          schema:
            type: integer
            example: 5
        - name: bookmark
          in: query
          description: Bookmark for pagination.
          required: false
          schema:
            type: string
            example: "bm12345"
        - name: filter
          in: query
          description: |
            Filter criteria. Example format: field[operation]=value.
            Supported operations for string fields: eq (equal), ne (not equal), ct (contains), nc (not contains).
            Supported operations for date fields: bf (before), eq (equal), af (after).
            Supported operations for number fields: eq (equal), ne (not equal), lt (less than), le (less or equal), gt (greater than), ge (greater or equal).
          required: false
          schema:
            type: string
            example: status[eq]=active
      responses:
        '200':
          description: Successful operation. Returns the list of CAs.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetCertificatesResponse'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: CA not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: CA not found
        '500':
          description: Something went wrong while getting certificates.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/{id}/certificates/status/{status}:
    get:
      tags:
        - CAs
      summary: Get Certificates by CA and Status
      description: Get Certificates by CA and Status
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the CA certificates to retrieve.
          schema:
            type: string
        - name: status
          in: path
          required: true
          description: Status of the certificates
          schema:
            $ref: '#/components/schemas/CertificateStatus'
        - name: sort_by
          in: query
          description: Field by which to sort the results.
          required: false
          schema:
            type: string
            example: name
        - name: sort_mode
          in: query
          description: Sort mode, can be 'asc' for ascending or 'desc' for descending.
          required: false
          schema:
            type: string
            enum: [asc, desc]
            example: asc
        - name: page_size
          in: query
          description: Number of items per page.
          required: false
          schema:
            type: integer
            example: 5
        - name: bookmark
          in: query
          description: Bookmark for pagination.
          required: false
          schema:
            type: string
            example: "bm12345"
        - name: filter
          in: query
          description: |
            Filter criteria. Example format: field[operation]=value.
            Supported operations for string fields: eq (equal), ne (not equal), ct (contains), nc (not contains).
            Supported operations for date fields: bf (before), eq (equal), af (after).
            Supported operations for number fields: eq (equal), ne (not equal), lt (less than), le (less or equal), gt (greater than), ge (greater or equal).
          required: false
          schema:
            type: string
            example: status[eq]=active
      responses:
        '200':
          description: Successful operation. Returns the list of Certificates.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetCertificatesResponse'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: CA not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: CA not found
        '500':
          description: Something went wrong while getting certificates.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/{id}/certificates/sign:
    post:
      tags:
        - CAs
      summary: Sign Certificate
      description: Sign Certificate
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the CA certificate to sign.
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SingCertificateInput'
      responses:
        '201':
          description: Successful operation. Returns the CA information.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CACertificate'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: CA not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: CA not found
        '500':
          description: Something went wrong while singing the certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/{id}/signature/sign:
    post:
      tags:
        - CAs
      summary: Sign Message
      description: Sign Message
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the CA used for signing.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignatureSignBody'
      responses:
        '200':
          description: Successful operation. Returns the signed data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignResponse'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: CA not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: CA not found
        '500':
          description: Something went wrong while signing message.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/{id}/signature/verify:
    post:
      tags:
        - CAs
      summary: Verify Signature
      description: Verify Signature
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the CA to verify.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignatureVerifyBody'
      responses:
        '200':
          description: Successful operation. Returns the verification result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyResponse'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: CA not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: CA not found
        '500':
          description: Something went wrong while verifying the signature.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /cas/{id}/certificates/{sn}:
    get:
      tags:
        - CAs
      summary: Get Certificate by Serial Number
      description: Get Certificate by Serial Number
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID of the CA
        - in: path
          name: sn
          required: true
          schema:
            type: string
          description: Serial number of the certificate
      responses:
        '200':
          description: Successful operation. Returns the Certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Certificate'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: Certificate not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: certificate not found
        '500':
          description: Something went wrong while getting the certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /certificates:
    get:
      tags:
        - certificates
      summary: Get Certificates
      description: Update CA Metadata
      parameters: 
        - name: sort_by
          in: query
          description: Field by which to sort the results.
          required: false
          schema:
            type: string
            example: name
        - name: sort_mode
          in: query
          description: Sort mode, can be 'asc' for ascending or 'desc' for descending.
          required: false
          schema:
            type: string
            enum: [asc, desc]
            example: asc
        - name: page_size
          in: query
          description: Number of items per page.
          required: false
          schema:
            type: integer
            example: 5
        - name: bookmark
          in: query
          description: Bookmark for pagination.
          required: false
          schema:
            type: string
            example: "bm12345"
        - name: filter
          in: query
          description: |
            Filter criteria. Example format: field[operation]=value.
            Supported operations for string fields: eq (equal), ne (not equal), ct (contains), nc (not contains).
            Supported operations for date fields: bf (before), eq (equal), af (after).
            Supported operations for number fields: eq (equal), ne (not equal), lt (less than), le (less or equal), gt (greater than), ge (greater or equal).
          required: false
          schema:
            type: string
            example: status[eq]=active
      responses:
        '200':
          description: Successful operation. Returns all Certificates.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetCertificatesResponse'
        '500':
          description: Something went wrong while getting all certificates.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /certificates/status/{status}:
    get:
      tags:
        - certificates
      summary: Get Certificates by Status
      description: Get certificates by status
      parameters:
        - in: path
          name: status
          required: true
          schema:
            type: string
          description: Status of the certificates to retrieve
        - name: sort_by
          in: query
          description: Field by which to sort the results.
          required: false
          schema:
            type: string
            example: name
        - name: sort_mode
          in: query
          description: Sort mode, can be 'asc' for ascending or 'desc' for descending.
          required: false
          schema:
            type: string
            enum: [asc, desc]
            example: asc
        - name: page_size
          in: query
          description: Number of items per page.
          required: false
          schema:
            type: integer
            example: 5
        - name: bookmark
          in: query
          description: Bookmark for pagination.
          required: false
          schema:
            type: string
            example: "bm12345"
        - name: filter
          in: query
          description: |
            Filter criteria. Example format: field[operation]=value.
            Supported operations for string fields: eq (equal), ne (not equal), ct (contains), nc (not contains).
            Supported operations for date fields: bf (before), eq (equal), af (after).
            Supported operations for number fields: eq (equal), ne (not equal), lt (less than), le (less or equal), gt (greater than), ge (greater or equal).
          required: false
          schema:
            type: string
            example: status[eq]=active
      responses:
        '200':
          description: Successful operation. Returns list of Certificates.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetCertificatesResponse'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '500':
          description: Something went wrong while getting certificates.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /certificates/expiration:
    get:
      tags:
        - certificates
      summary: Get Certificates by Expiration Date
      description: Get Certificates by Expiration Date
      parameters:
        - in: query
          name: expires_after
          schema:
            type: string
            format: date-time
          description: Return certificates expiring after this date (RFC3339 format)
        - in: query
          name: expires_before
          schema:
            type: string
            format: date-time
          description: Return certificates expiring before this date (RFC3339 format)
        - name: sort_by
          in: query
          description: Field by which to sort the results.
          required: false
          schema:
            type: string
            example: name
        - name: sort_mode
          in: query
          description: Sort mode, can be 'asc' for ascending or 'desc' for descending.
          required: false
          schema:
            type: string
            enum: [asc, desc]
            example: asc
        - name: page_size
          in: query
          description: Number of items per page.
          required: false
          schema:
            type: integer
            example: 5
        - name: bookmark
          in: query
          description: Bookmark for pagination.
          required: false
          schema:
            type: string
            example: "bm12345"
        - name: filter
          in: query
          description: |
            Filter criteria. Example format: field[operation]=value.
            Supported operations for string fields: eq (equal), ne (not equal), ct (contains), nc (not contains).
            Supported operations for date fields: bf (before), eq (equal), af (after).
            Supported operations for number fields: eq (equal), ne (not equal), lt (less than), le (less or equal), gt (greater than), ge (greater or equal).
          required: false
          schema:
            type: string
            example: status[eq]=active
      responses:
        '200':
          description: Successful operation. Returns list of Certificates.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetCertificatesResponse'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '500':
          description: Something went wrong while getting certificates.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /certificates/{sn}:
    get:
      tags:
        - certificates
      summary: Get Certificate by Serial Number
      description: Get Certificate by Serial Number
      parameters:
        - in: path
          name: sn
          required: true
          schema:
            type: string
          description: The serial number of the certificate
      responses:
        '200':
          description: Successful operation. Returns the Certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Certificate'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: Certificate not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: certificate not found
        '500':
          description: Something went wrong while getting the certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /certificates/{sn}/status:
    put:
      tags:
        - certificates
      summary: Update Certificate Status
      description: Update Certificate Status
      parameters:
        - in: path
          name: sn
          required: true
          schema:
            type: string
          description: The serial number of the certificate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCertificateStatusBody'
      responses:
        '200':
          description: Successful operation. Returns the updated Certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Certificate'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: Certificate not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: certificate not found
        '500':
          description: Something went wrong while updating certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /certificates/{sn}/metadata:
    put:
      tags:
        - certificates
      summary: Update Certificate Metadata
      description: Update Certificate Metadata
      parameters:
        - in: path
          name: sn
          required: true
          schema:
            type: string
          description: The serial number of the certificate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCertificateMetadataBody'
      responses:
        '200':
          description: Successful operation. Returns the updated Certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Certificate'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '404':
          description: Certificate not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/404Error'
              example:
                err: certificate not found
        '500':
          description: Something went wrong while updating certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /certificates/import:
    post:
      tags:
        - certificates
      summary: Import Certificate
      description: Import Certificate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImportCertificateBody'
      responses:
        '201':
          description: Successful operation. Returns the updated Certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Certificate'
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '500':
          description: Something went wrong while importing certificate.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /engines:
    get:
      tags:
        - engines
      summary: Get Crypto Engine Provider
      description: Get Crypto Engine Provider
      responses:
        '200':
          description: Successful operation. Returns the crypto engine provider.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CryptoEngineProvider'
        '500':
          description: Something went wrong while getting the crypto engine provider.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /stats:
    get:
      tags:
        - stats
      summary: Get Stats
      description: Get Stats
      responses:
        '200':
          description: Successful operation. Returns the certificate stats.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CAStats'
        '500':
          description: Something went wrong while getting the stats.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
  /stats/{id}:
    get:
      tags:
        - stats
      summary: Get Stats by CA ID
      description: Get Stats by CA ID
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the CA
          schema:
            type: string
      responses:
        '200':
          description: Successful operation. Returns the Certificates stats.
          content:
            application/json:
              schema:
                type: object
                properties:
                  certificateStatus:
                    $ref: '#/components/schemas/CertificateStatus'
                  additionalProperties:
                    type: integer
        '400':
          description: Struct Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400Error'
              example:
                err: struct Validation error
        '500':
          description: Something went wrong while getting stats.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/500Error'
components:
  schemas:
    GetCAsResponse:
      type: object
      properties:
        next:
          type: string
        list:
          type: array
          items:
            $ref: '#/components/schemas/CACertificate'
    GetCertificatesResponse:
      type: object
      properties:
        next:
          type: string
        list:
          type: array
          items:
            $ref: '#/components/schemas/Certificate'
    Certificate:
      type: object
      properties:
        serial_number:
          type: string
        metadata:
          type: object
          additionalProperties: {}
        issuer_ca_metadata:
          $ref: '#/components/schemas/IssuerCAMetadata'
        certificate_status:
          $ref: '#/components/schemas/CertificateStatus'
        certificate:
          $ref: '#/components/schemas/X509Certificate'
        key_metadata:
          $ref: '#/components/schemas/KeyStrengthMetadata'
        subject:
          $ref: '#/components/schemas/Subject'
        valid_from:
          type: string
          format: date-time
        valid_to:
          type: string
          format: date-time
        revocation_timestamp:
          type: string
          format: date-time
        revocation_reason:
          type: integer
        certificate_type:
          $ref: '#/components/schemas/CertificateType'
        engine_id:
          type: string
    CACertificate:
      allOf:
        - $ref: '#/components/schemas/Certificate'
        - type: object
          properties:
            id:
              type: string
            issuance_expiration_ref:
              $ref: '#/components/schemas/Expiration'
            creation_ts:
              type: string
              format: date-time
            level:
              type: integer
    IssuerCAMetadata:
      type: object
      properties:
        serial_number:
          type: string
        id:
          type: string
        level:
          type: integer
    X509Certificate:
      type: object
      properties:
        raw:
          type: string
          format: byte
        raw_tbs_certificate:
          type: string
          format: byte
        raw_subject_public_key_info:
          type: string
          format: byte
        raw_subject:
          type: string
          format: byte
        raw_issuer:
          type: string
          format: byte
        signature:
          type: string
          format: byte
        signature_algorithm:
          type: integer
        public_key_algorithm:
          type: integer
        public_key:
          type: object
        version:
          type: integer
        serial_number:
          $ref: '#/components/schemas/BigInt'
        issuer:
          $ref: '#/components/schemas/pkixName'
        subject:
          $ref: '#/components/schemas/pkixName'
        not_before:
          type: string
          format: date-time
        not_after:
          type: string
          format: date-time
        key_usage:
          type: integer
        extensions:
          type: array
          items:
            $ref: '#/components/schemas/pkixExtension'
        extra_extensions:
          type: array
          items:
            $ref: '#/components/schemas/pkixExtension'
        unhandled_critical_extensions:
          type: array
          items:
            type: array
            items:
              type: integer
        ext_key_usage:
          type: array
          items:
            type: integer
        unknown_ext_key_usage:
          type: array
          items:
            type: array
            items:
              type: integer
        basic_constraints_valid:
          type: boolean
        is_ca:
          type: boolean
        max_path_len:
          type: integer
        max_path_len_zero:
          type: boolean
        subject_key_id:
          type: string
          format: byte
        authority_key_id:
          type: string
          format: byte
        ocsp_server:
          type: array
          items:
            type: string
        issuing_certificate_url:
          type: array
          items:
            type: string
        dns_names:
          type: array
          items:
            type: string
        email_addresses:
          type: array
          items:
            type: string
        ip_addresses:
          type: array
          items:
            type: string
            format: ipv4
        uris:
          type: array
          items:
            $ref: '#/components/schemas/URL'
        permitted_dns_domains_critical:
          type: boolean
        permitted_dns_domains:
          type: array
          items:
            type: string
        excluded_dns_domains:
          type: array
          items:
            type: string
        permitted_ip_ranges:
          type: array
          items:
            $ref: '#/components/schemas/IPNet'
        excluded_ip_ranges:
          type: array
          items:
            $ref: '#/components/schemas/IPNet'
        permitted_email_addresses:
          type: array
          items:
            type: string
            format: email
        excluded_email_addresses:
          type: array
          items:
            type: string
            format: email
        permitted_uri_domains:
          type: array
          items:
            type: string
            format: uri
        excluded_uri_domains:
          type: array
          items:
            type: string
            format: uri
        crl_distribution_points:
          type: array
          items:
            type: string
        policy_identifiers:
          type: array
          items:
            type: array
            items:
              type: integer
        policies:
          type: array
          items:
            $ref: '#/components/schemas/OID' 
    KeyMetadata:
      type: object
      properties:
        key_type:
          type: string
          enum:
            - UnknownPublicKeyAlgorithm
            - RSA
            - DSA
            - ECDSA
            - Ed25519
        bits:
          type: integer
    KeyStrengthMetadata:
      allOf:
        - $ref: '#/components/schemas/KeyMetadata'
        - type: object
      properties:
        key_strength:
          type: string
          enum:
            - HIGH
            - MEDIUM
            - LOW
    Subject:
      type: object
      properties:
        common_name:
          type: string
        organization:
          type: string
        organization_unit:
          type: string
        country:
          type: string
        state:
          type: string
        locality:
          type: string
    Expiration:
      type: object
      properties:
        expiration_type:
          type: string
          enum:
            - Duration
            - Time
        duration:
          type: integer
        time:
          type: string
          format: date-time
    CreateCABody:
      type: object
      properties:
        parent_id:
          type: string
        id:
          type: string
        key_metadata:
          $ref: '#/components/schemas/KeyMetadata'
        subject:
          $ref: '#/components/schemas/Subject'
        ca_expiration:
          $ref: '#/components/schemas/Expiration'
        issuance_expiration:
          $ref: '#/components/schemas/Expiration'
        engine_id:
          type: string
        metadata:
          type: object
          additionalProperties: true
    ImportCA:
      type: object
      properties:
        id:
          type: string
        engine_id:
          type: string
        parent_id:
          type: string
    ImportCABody:
      allOf:
        - $ref: '#/components/schemas/Certificate'
        - type: object
      properties:
        id:
          type: string
        engine_id:
          type: string
        parent_id:
          type: string
        ca_private_key:
          type: string
          description: Base64 encoded private key from PEM
        ca_certificate:
          $ref: '#/components/schemas/X509Certificate'
        ca_chain:
          type: array
          items:
            $ref: '#/components/schemas/X509Certificate'
        ca_type:
          $ref: '#/components/schemas/CertificateType'
        issuance_expiration:
          $ref: '#/components/schemas/Expiration'
    CertificateType:
      type: string
      enum:
        - MANAGED
        - IMPORTED
        - EXTERNAL
    ImportCAInput:
      type: object
      properties:
        id:
          type: string
        ca_type:
          $ref: '#/components/schemas/CertificateType'
        issuance_expiration:
          $ref: '#/components/schemas/Expiration'
        ca_certificate:
          $ref: '#/components/schemas/X509Certificate'
        ca_chain:
          type: array
          items:
            $ref: '#/components/schemas/X509Certificate'
          description: >
            Parent CAs. They MUST be sorted as follows: 0: Root-CA; 1:
            Subordinate CA from Root-CA; ...
        ca_rsa_key:
          $ref: '#/components/schemas/RSAKey'
        ca_ec_key:
          $ref: '#/components/schemas/ECDSAKey'
        key_type:
          type: string
        engine_id:
          type: string
        parent_id:
          type: string
      required:
        - ca_type
        - issuance_expiration
        - ca_certificate
    RSAKey:
      allOf:
        - $ref: '#/components/schemas/ECDSAKey'
        - type: object
      properties:
        primes:
          type: array
          items:
            type: string
          description: >-
            Prime factors of N, has >= 2 elements, represented as a base-10
            string to handle large integer
        precomputed:
            $ref: '#/components/schemas/PrecomputedValues'
    ECDSAKey:
      type: object
      properties:
        public_key:
          $ref: '#/components/schemas/PublicKey'
        D:
          type: string
          description: Represented as a base-10 string to handle large integers
    PublicKey:
      type: object
      properties:
        N:
          type: string
          description: Modulus, represented as a base-10 string to handle large integers
        E:
          type: integer
          description: Public exponent
    PrecomputedValues:
      type: object
      properties:
        Dp:
          type: string
          description: >
            D mod (P-1) (or mod Q-1), represented as a base-10 string to handle
            large integers
        Dq:
          type: string
          description: >
            D mod (Q-1), represented as a base-10 string to handle large
            integers
        Qinv:
          type: string
          description: |
            Q^-1 mod P, represented as a base-10 string to handle large integers
        n:
          $ref: '#/components/schemas/Modulus'
        p:
          $ref: '#/components/schemas/Modulus'
        q:
          $ref: '#/components/schemas/Modulus'
    Modulus:
      type: object
      properties:
        nat:
          type: string
          description: >
            The underlying natural number for this modulus, represented as a
            base-10 string to handle large integers.
        leading:
          type: integer
          description: Number of leading zeros in the modulus.
        m0inv:
          type: integer
          description: '-nat.limbs[0]⁻¹ mod _W.'
        rr:
          type: string
          description: >
            R*R for Montgomery representation, represented as a base-10 string
            to handle large integers.
    UpdateCertificateStatusBody:
      type: object
      properties:
        new_status:
          $ref: '#/components/schemas/CertificateStatus'
        revocation_reason:
          type: integer
    CertificateStatus:
      type: string
      enum:
        - ACTIVE
        - EXPIRED
        - REVOKED
    SingCertificateInput:
      type: object
      required:
        - CAID
        - CertRequest
      properties:
        CAID:
          type: string
        cert_request:
          $ref: '#/components/schemas/X509CertificateRequest'
        subject:
          $ref: '#/components/schemas/Subject'
        sign_verbatim:
          type: boolean
    X509CertificateRequest:
      type: object
      properties:
        raw:
          type: string
          format: byte
          description: Complete ASN.1 DER content (CSR, signature algorithm and signature)
        raw_tbs_certificate_request:
          type: string
          format: byte
          description: Certificate request info part of raw ASN.1 DER content
        raw_subject_public_key_info:
          type: string
          format: byte
          description: DER encoded SubjectPublicKeyInfo
        raw_subject:
          type: string
          format: byte
          description: DER encoded Subject
        version:
          type: integer
          description: Version of the certificate request
        signature:
          type: string
          format: byte
          description: Signature of the certificate request
        signature_algorithm:
          type: integer
          description: Algorithm used for the signature
        public_key_algorithm:
          type: integer
          description: Algorithm used for the public key
        public_key:
          type: object
          description: Public key information
        subject:
          $ref: '#/components/schemas/pkixName'
        attributes:
          type: array
          items:
            $ref: '#/components/schemas/pkixAttributeTypeAndValueSET'
          description: CSR attributes
        extensions:
          type: array
          items:
            $ref: '#/components/schemas/pkixExtension'
          description: All requested extensions, in raw form
        extra_extensions:
          type: array
          items:
            $ref: '#/components/schemas/pkixExtension'
          description: >-
            Extensions to be copied raw into any CSR marshaled by
            CreateCertificateRequest
        dns_names:
          type: array
          items:
            type: string
          description: Subject Alternate Name values for DNS names
        email_addresses:
          type: array
          items:
            type: string
          description: Subject Alternate Name values for email addresses
        ip_addresses:
          type: array
          items:
            type: string
            format: byte
          description: Subject Alternate Name values for IP addresses
        uris:
          type: array
          items:
            $ref: '#/components/schemas/URL'
          description: Subject Alternate Name values for URIs
    pkixName:
      type: object
      properties:
        country:
          type: array
          items:
            type: string
        organization:
          type: array
          items:
            type: string
        organizational_unit:
          type: array
          items:
            type: string
        locality:
          type: array
          items:
            type: string
        province:
          type: array
          items:
            type: string
        street_address:
          type: array
          items:
            type: string
        postal_code:
          type: array
          items:
            type: string
        serial_number:
          type: string
        common_name:
          type: string
        names:
          type: array
          items:
            $ref: '#/components/schemas/pkixAttributeTypeAndValue'
          description: All parsed attributes
        extra_names:
          type: array
          items:
            $ref: '#/components/schemas/pkixAttributeTypeAndValue'
          description: Attributes to be copied raw into any marshaled distinguished names
    pkixAttributeTypeAndValue:
      type: object
      properties:
        type:
          type: array
          items:
            type: integer
        value:
          type: object
    pkixAttributeTypeAndValueSET:
      type: object
      properties:
        type:
          type: array
          items:
            type: integer
          description: ASN.1 Object Identifier
        value:
          type: array
          items:
            type: array
            items:
              $ref: '#/components/schemas/pkixAttributeTypeAndValue'
          description: A set of sets of AttributeTypeAndValue
    pkixExtension:
      type: object
      properties:
        id:
          type: array
          items:
            type: integer
        critical:
          type: boolean
        value:
          type: string
          format: byte
    URL:
      type: object
      properties:
        scheme:
          type: string
        opaque:
          type: string
          description: Encoded opaque data
        user:
          $ref: '#/components/schemas/UserInfo'
        host:
          type: string
          description: Host or host:port
        path:
          type: string
          description: Path (relative paths may omit leading slash)
        raw_path:
          type: string
          description: Encoded path hint
        omit_host:
          type: boolean
          description: Do not emit empty host (authority)
        force_query:
          type: boolean
          description: Append a query ('?') even if RawQuery is empty
        raw_query:
          type: string
          description: Encoded query values, without '?'
        fragment:
          type: string
          description: Fragment for references, without '#'
        raw_fragment:
          type: string
          description: Encoded fragment hint
    UserInfo:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
        password_set:
          type: boolean
    SignatureSignBody:
      type: object
      properties:
        message:
          type: string
        type:
          type: string
          enum:
            - hash
            - raw
        signing_algorithm:
          type: string
    SignResponse:
      type: object
      properties:
        signed_data:
          type: string
          format: byte
    SignatureVerifyBody:
      allOf:
        - $ref: '#/components/schemas/SignatureSignBody'
        - type: object
      properties:
        signature:
          type: string
    VerifyResponse:
      type: object
      properties:
        valid:
          type: boolean
          description: Indicates whether the signature is valid or not.
    UpdateCertificateMetadataBody:
      type: object
      properties:
        metadata:
          type: object
          additionalProperties: true
    ImportCertificateBody:
      type: object
      required:
        - certificate
      properties:
        metadata:
          type: object
          additionalProperties: true
        certificate:
          $ref: '#/components/schemas/X509Certificate'
    CryptoEngineProvider:
      allOf:
        - $ref: '#/components/schemas/CryptoEngineInfo'
        - type: object
      properties:
        id:
          type: string
        default:
          type: boolean
    CryptoEngineInfo:
      type: object
      properties:
        type:
          type: string
          enum:
            - PKCS11
            - AzureKeyVault
            - GOLANG
            - VaultKV2
            - AWSKMS
            - AWSSecretsManager
        security_level:
          type: integer
        provider:
          type: string
        name:
          type: string
        metadata:
          type: object
          additionalProperties: true
        supported_key_types:
          type: array
          items:
            $ref: '#/components/schemas/SupportedKeyTypeInfo'
    SupportedKeyTypeInfo:
      type: object
      properties:
        type:
          type: integer
        sizes:
          type: array
          items:
            type: integer
    CAStats:
      type: object
      properties:
        CA_ertificates_stats:
          $ref: '#/components/schemas/CertificatesStats'
        certificates_stats:
          $ref: '#/components/schemas/CertificatesStats'
    CertificatesStats:
      type: object
      properties:
        total:
          type: integer
        distribution:
          type: object
          additionalProperties:
            type: integer
        status:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/CertificateStatus'
    BigInt:
      type: object
      properties:
        neg:
          type: boolean
        abs:
            type: integer
    IPNet:
      type: object
      properties:
        IP:
          type: string
          format: ipv4
        IPMask:
          type: string
          format: ipv4
    OID:
      type: object
      properties:
        der:
          type: string
          format: byte
    400Error:
      type: object
      properties:
        err: 
          type: string
          enum:
            - struct validation error
            - CA type inconsistent
            - issuance expiration greater than CA expiration
            - incompatible expiration time ref
            - CA and the provided key dont match
    404Error:
      type: object
      properties:
        err: 
          type: string
          enum:
            - CA not found
            - certificate not found
    409Error:
      type: object
      properties:
        err: 
          type: string
          enum:
            - CA already exists
    500Error:
      type: object
      properties:
        err: 
          type: string
          enum:
            - internal Server Error
          example: internal Server Error
  securitySchemes:
    MTLS:
      type: mutualTLS
    Oauth2Password:
      type: oauth2
      flows:
        clientCredentials:
          tokenUrl: https://example.com/oauth/token
          scopes:
            read: Grants read access
            write: Grants write access
    NoAuth:
      type: http
      scheme: bearer
          
servers:
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/MIKELELOLA003_1/Lamassuiot_CA/1.0.0
  - description: Local
    url: https://localhost:8443/api/ca/v1